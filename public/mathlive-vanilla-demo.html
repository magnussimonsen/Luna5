<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>MathLive Vanilla Demo</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- Load MathLive from CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/mathlive"></script>
    <style>
        :root {
            --bg: #0f1115;
            --panel: #181c22;
            --border: #2c333b;
            --accent: #5cff94;
            --menu-bg: #141b22;
            --menu-hover: #1f2730;
            --menu-border: #2a3640;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            font-family: system-ui, sans-serif;
            background: var(--bg);
            color: #fff;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 32px 32px;
            gap: 24px;
            box-sizing: border-box;
        }

        /* Menu Bar */
        .menubar-wrapper {
            width: 100%;
            display: flex;
            justify-content: center;
            background: var(--menu-bg);
            border-bottom: 1px solid var(--menu-border);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .4);
        }

        .menubar {
            width: 100%;
            max-width: 960px;
            display: flex;
            gap: 8px;
            padding: 8px 16px;
            box-sizing: border-box;
            align-items: center;
        }

        .menubar button,
        .menubar .menubar-trigger {
            background: transparent;
            color: #fff;
            border: 1px solid transparent;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font: inherit;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .menubar button:hover,
        .menubar .menubar-trigger:hover {
            background: var(--menu-hover);
        }

        .menubar button:focus-visible,
        .menubar .menubar-trigger:focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        .menubar-group {
            position: relative;
        }

        .menubar-trigger {
            position: relative;
        }

        .dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--menu-bg);
            border: 1px solid var(--menu-border);
            border-radius: 8px;
            padding: 6px;
            min-width: 180px;
            display: none;
            flex-direction: column;
            gap: 2px;
            box-shadow: 0 8px 18px rgba(0, 0, 0, .55);
            z-index: 40;
        }

        .dropdown[aria-hidden="false"] {
            display: flex;
        }

        .dropdown button {
            width: 100%;
            text-align: left;
            padding: 6px 10px;
            border-radius: 4px;
            background: transparent;
        }

        .dropdown button:hover {
            background: var(--menu-hover);
        }

        .dropdown hr {
            border: none;
            border-top: 1px solid var(--menu-border);
            margin: 5px 0;
        }

        .kbd-hint {
            opacity: .55;
            font-size: .65rem;
            margin-left: auto;
        }

        .spacer {
            flex: 1 1 auto;
        }

        .brand {
            font-size: .9rem;
            opacity: .65;
            letter-spacing: .5px;
        }

        header {
            text-align: center;
            max-width: 760px;
        }

        header h1 {
            margin: 0 0 8px;
            font-size: 1.9rem;
        }

        header p {
            margin: 0;
            opacity: 0.8;
        }

        .panel {
            width: 100%;
            max-width: 760px;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 24px;
            box-sizing: border-box;
        }

        math-field {
            width: 100%;
            min-height: 120px;
            display: block;
            background: #fff;
            color: #000;
            border-radius: 6px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 16px;
        }

        button {
            background: #24303a;
            border: 1px solid var(--border);
            color: #fff;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
        }

        button:hover {
            background: #2e3b46;
        }

        button:active {
            background: #222d35;
        }

        pre {
            margin: 0;
            background: #fff;
            color: #000;
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
        }

        .output {
            margin-top: 16px;
        }

        .copied {
            color: var(--accent);
            font-weight: 600;
            margin-left: 8px;
        }

        footer {
            opacity: 0.5;
            font-size: 0.75rem;
            margin-top: auto;
        }

        a {
            color: var(--accent);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <div class="menubar-wrapper" role="navigation" aria-label="Demo menu">
        <div class="menubar" id="menubar">
            <div class="menubar-group">
                <button class="menubar-trigger" aria-haspopup="true" aria-expanded="false" data-menu="file-menu">Menu
                    ▾</button>
                <div class="dropdown" id="file-menu" role="menu" aria-hidden="true">
                    <button type="button" data-action="insert-quadratic" role="menuitem">Insert quadratic <span
                            class="kbd-hint">Alt+1</span></button>
                    <button type="button" data-action="insert-matrix" role="menuitem">Insert matrix <span
                            class="kbd-hint">Alt+2</span></button>
                    <button type="button" data-action="insert-fraction" role="menuitem">Insert fraction <span
                            class="kbd-hint">Alt+3</span></button>
                    <hr />
                    <button type="button" data-action="toggle-keyboard" role="menuitem">Toggle keyboard <span
                            class="kbd-hint">Alt+K</span></button>
                    <button type="button" data-action="clear" role="menuitem">Clear field <span
                            class="kbd-hint">Alt+X</span></button>
                    <button type="button" data-action="copy" role="menuitem">Copy LaTeX <span
                            class="kbd-hint">Alt+C</span></button>
                </div>
            </div>
            <div class="spacer"></div>
            <div class="brand">MathLive Demo</div>
        </div>
    </div>

    <header>
        <h1>MathLive Vanilla HTML Demo</h1>
        <p>An isolated <code>&lt;math-field&gt;</code> example. Type inline or block math, toggle the virtual keyboard,
            copy LaTeX, or reset.</p>
    </header>

    <section class="panel">
        <math-field id="mf">x=\frac{-b\pm \sqrt{b^2-4ac}}{2a}</math-field>
        <div class="controls">
            <button type="button" id="btn-toggle">Toggle Keyboard</button>
            <button type="button" id="btn-reset">Reset</button>
            <button type="button" id="btn-copy">Copy LaTeX</button>
            <span id="copied-indicator" class="copied" style="display:none">Copied ✓</span>
        </div>
        <div class="output">
            <h3 style="margin:0 0 8px">LaTeX Output</h3>
            <pre id="latex-output"></pre>
        </div>
    </section>

    <footer>Powered by <a href="https://mathlive.io" target="_blank" rel="noopener">MathLive</a></footer>

    <script>
        // Wait for custom element definition (in case script loads before element is upgraded)
        customElements.whenDefined('math-field').then(() => {
            const mf = document.getElementById('mf');
            const out = document.getElementById('latex-output');
            const btnToggle = document.getElementById('btn-toggle');
            const btnReset = document.getElementById('btn-reset');
            const btnCopy = document.getElementById('btn-copy');
            const copied = document.getElementById('copied-indicator');

            function updateLatex() {
                if (!mf) return;
                out.textContent = mf.getValue ? mf.getValue('latex-expanded') : mf.value || '';
            }

            mf.addEventListener('input', updateLatex);
            mf.addEventListener('focus', updateLatex);
            updateLatex();

            btnToggle.addEventListener('click', () => {
                if (mf.executeCommand) mf.executeCommand('toggleVirtualKeyboard');
            });

            btnReset.addEventListener('click', () => {
                mf.value = '';
                updateLatex();
            });

            btnCopy.addEventListener('click', async () => copyLatex());

            // Menu logic
            const fileMenu = document.getElementById('file-menu');
            const trigger = document.querySelector('[data-menu="file-menu"]');
            function closeMenu() {
                if (!fileMenu || !trigger) return;
                fileMenu.setAttribute('aria-hidden', 'true');
                trigger.setAttribute('aria-expanded', 'false');
            }
            function openMenu() {
                if (!fileMenu || !trigger) return;
                fileMenu.setAttribute('aria-hidden', 'false');
                trigger.setAttribute('aria-expanded', 'true');
            }
            trigger.addEventListener('click', () => {
                const expanded = trigger.getAttribute('aria-expanded') === 'true';
                expanded ? closeMenu() : openMenu();
            });
            document.addEventListener('click', (e) => {
                if (!fileMenu || !trigger) return;
                if (fileMenu.contains(e.target) || trigger.contains(e.target)) return;
                closeMenu();
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeMenu();
            });

            function copyLatex() {
                if (!navigator.clipboard) return;
                navigator.clipboard.writeText(out.textContent || '');
                copied.style.display = 'inline';
                setTimeout(() => (copied.style.display = 'none'), 1400);
            }

            function insertLatex(latex) {
                if (!mf) return;
                mf.value = (mf.value || '') + (mf.value ? ' ' : '') + latex;
                if (mf.executeCommand) mf.executeCommand('moveToMathfieldEnd');
                const evt = new Event('input');
                mf.dispatchEvent(evt);
            }

            fileMenu.addEventListener('click', (e) => {
                const btn = e.target.closest('button[data-action]');
                if (!btn) return;
                const action = btn.getAttribute('data-action');
                switch (action) {
                    case 'insert-quadratic':
                        insertLatex('x=\\frac{-b\\pm\\sqrt{b^{2}-4ac}}{2a}');
                        break;
                    case 'insert-matrix':
                        insertLatex('\\begin{bmatrix}a & b \\\\ c & d\\end{bmatrix}');
                        break;
                    case 'insert-fraction':
                        insertLatex('\\frac{1}{1+e^{-x}}');
                        break;
                    case 'toggle-keyboard':
                        if (mf.executeCommand) mf.executeCommand('toggleVirtualKeyboard');
                        break;
                    case 'clear':
                        mf.value = '';
                        const evt = new Event('input');
                        mf.dispatchEvent(evt);
                        break;
                    case 'copy':
                        copyLatex();
                        break;
                }
                closeMenu();
            });

            // Keyboard shortcuts
            window.addEventListener('keydown', (e) => {
                if (!e.altKey) return;
                switch (e.key.toLowerCase()) {
                    case '1':
                        insertLatex('x=\\frac{-b\\pm\\sqrt{b^{2}-4ac}}{2a}');
                        break;
                    case '2':
                        insertLatex('\\begin{bmatrix}a & b \\\\ c & d\\end{bmatrix}');
                        break;
                    case '3':
                        insertLatex('\\frac{1}{1+e^{-x}}');
                        break;
                    case 'k':
                        if (mf.executeCommand) mf.executeCommand('toggleVirtualKeyboard');
                        break;
                    case 'x':
                        mf.value = '';
                        mf.dispatchEvent(new Event('input'));
                        break;
                    case 'c':
                        copyLatex();
                        break;
                }
            });
        });
    </script>
</body>

</html>